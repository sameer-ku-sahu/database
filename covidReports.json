{"_id":"AppointmentCountsAllSites","title":"Appointment Counts All Sites","parameters":[{"key":"appointmentsFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Appointments From","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"appointmentsTo","ui":{"ordinal":{"$numberInt":"2"},"label":"Appointments To","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}}],"rules":{"appointmentDateRange":{"type":"DateSpan","dateFrom":"appointmentsFrom","dateTo":"appointmentsTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"89"}},"message":"Date range must span at least one day and not more than 90 days."}},"plans":[{"driver":"covidTestAppointments","pipeline":[{"$match":{"appointmentDate":{"$gte":null,"$lt":null}}},{"$unwind":{"path":"$appointments"}},{"$lookup":{"from":"covidTestTracking","localField":"appointments.engagementId","foreignField":"_id","as":"TT"}},{"$unwind":{"path":"$TT"}},{"$group":{"_id":{"site":"$storeNumber","date":"$appointmentDate"},"booked":{"$sum":{"$cond":[{"$eq":["$appointments.appointmentStatus","Booked"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"bookedBinax":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Booked"]},{"$eq":["$TT.lab.testId","covidBinaxNOW"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"bookedIDNOW":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Booked"]},{"$eq":["$TT.lab.testId","covidIDNOW"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"bookedAegis":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Booked"]},{"$eq":["$TT.lab.testId","covidAegisPCR"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"bookedLabCorp":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Booked"]},{"$eq":["$TT.lab.testId","covidLabCorpPCR"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"cancelled":{"$sum":{"$cond":[{"$eq":["$appointments.appointmentStatus","Cancelled"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"cancelledBinax":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Cancelled"]},{"$eq":["$TT.lab.testId","covidBinaxNOW"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"cancelledIDNOW":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Cancelled"]},{"$eq":["$TT.lab.testId","covidIDNOW"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"cancelledAegis":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Cancelled"]},{"$eq":["$TT.lab.testId","covidAegisPCR"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"cancelledLabCorp":{"$sum":{"$cond":[{"$and":[{"$eq":["$appointments.appointmentStatus","Cancelled"]},{"$eq":["$TT.lab.testId","covidLabCorpPCR"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"resulted":{"$sum":{"$cond":[{"$eq":["$TT.partnerDecision","Resulted"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"resultedBinax":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.partnerDecision","Resulted"]},{"$eq":["$TT.lab.testId","covidBinaxNOW"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"resultedIDNOW":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.partnerDecision","Resulted"]},{"$eq":["$TT.lab.testId","covidIDNOW"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"resultedAegis":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.partnerDecision","Resulted"]},{"$eq":["$TT.lab.testId","covidAegisPCR"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"resultedLabCorp":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.partnerDecision","Resulted"]},{"$eq":["$TT.lab.testId","covidLabCorpPCR"]}]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"released":{"$sum":{"$cond":[{"$eq":["$appointments.appointmentStatus","Released"]},{"$numberInt":"1"},{"$numberInt":"0"}]}}}},{"$lookup":{"from":"covidTestSites","localField":"_id.site","foreignField":"storeNumber","as":"TS"}},{"$unwind":{"path":"$TS"}},{"$project":{"_id":{"$numberInt":"0"},"SiteNumber":"$TS.storeNumber","City":{"$toUpper":"$TS.address.city"},"State":{"$toUpper":"$TS.address.state"},"AppointmentDate":{"$dateToString":{"date":"$_id.date","format":"%Y-%m-%d"}},"TotalBooked":"$booked","BookedBinax":"$bookedBinax","BookedIDNOW":"$bookedIDNOW","BookedAegisPCR":"$bookedAegis","BookedLabCorpPCR":"$bookedLabCorp","TotalCancelled":"$cancelled","CancelledBinax":"$cancelledBinax","CancelledIDNOW":"$cancelledIDNOW","CancelledAegisPCR":"$cancelledAegis","CancelledLabCorpPCR":"$cancelledLabCorp","TotalResulted":"$resulted","ResultedBinax":"$resultedBinax","ResultedIDNOW":"$resultedIDNOW","ResultedAegisPCR":"$resultedAegis","ResultedLabCorpPCR":"$resultedLabCorp","Released":"$released"}},{"$sort":{"State":{"$numberInt":"1"},"City":{"$numberInt":"1"},"SiteNumber":{"$numberInt":"1"},"AppointmentDate":{"$numberInt":"1"}}}],"paths":{"appointmentsFrom":["[0].$match['appointmentDate'].$gte"],"appointmentsTo":["[0].$match['appointmentDate'].$lt"]}}],"output":{"filename":"AppointmentCounts.{ISODateTime}.csv","batchSize":{"$numberInt":"5000"},"decryption":[],"fields":["SiteNumber","City","State","AppointmentDate","TotalBooked","BookedBinax","BookedIDNOW","BookedAegisPCR","BookedLabCorpPCR","TotalCancelled","CancelledBinax","CancelledIDNOW","CancelledAegisPCR","CancelledLabCorpPCR","TotalResulted","ResultedBinax","ResultedIDNOW","ResultedAegisPCR","ResultedLabCorpPCR","Released"]}}
{"_id":"SameDayAppointmentSummary","title":"Same Day Appointment Summary","parameters":[{"key":"appointmentsFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Appointments From","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"appointmentsTo","ui":{"ordinal":{"$numberInt":"2"},"label":"Appointments To","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}}],"rules":{"appointmentDateRange":{"type":"DateSpan","dateFrom":"appointmentsFrom","dateTo":"appointmentsTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"6"}},"message":"Date range must span at least one day and not more than seven days."}},"plans":[{"driver":"covidTestAppointments","pipeline":[{"$match":{"appointmentDate":{"$gte":null,"$lt":null},"appointments.appointmentStatus":"Booked"}},{"$unwind":{"path":"$appointments"}},{"$match":{"appointments.appointmentStatus":"Booked"}},{"$lookup":{"from":"covidTestSites","localField":"storeNumber","foreignField":"storeNumber","as":"TS"}},{"$unwind":{"path":"$TS"}},{"$lookup":{"from":"covidTestTracking","localField":"appointments.engagementId","foreignField":"_id","as":"TT"}},{"$unwind":{"path":"$TT"}},{"$addFields":{"sameDay":{"$eq":[{"$dateToString":{"date":"$appointments.createDate","format":"%Y-%m-%d","timezone":"$TS.timeZoneIANA"}},{"$dateToString":{"date":"$appointmentDate","format":"%Y-%m-%d"}}]}}},{"$group":{"_id":{"site":"$storeNumber","date":"$appointmentDate"},"City":{"$first":"$TS.address.city"},"State":{"$first":"$TS.address.state"},"AllTotal":{"$sum":{"$numberInt":"1"}},"AllSameDay":{"$sum":{"$cond":["$sameDay",{"$numberInt":"1"},{"$numberInt":"0"}]}},"IDNOWTotal":{"$sum":{"$cond":[{"$eq":["$TT.lab.testId","covidIDNOW"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"IDNOWSameDay":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.lab.testId","covidIDNOW"]},"$sameDay"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"BinaxTotal":{"$sum":{"$cond":[{"$eq":["$TT.lab.testId","covidBinaxNOW"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"BinaxSameDay":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.lab.testId","covidBinaxNOW"]},"$sameDay"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"LabCorpTotal":{"$sum":{"$cond":[{"$eq":["$TT.lab.testId","covidLabCorpPCR"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"LabCorpSameDay":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.lab.testId","covidLabCorpPCR"]},"$sameDay"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"AegisTotal":{"$sum":{"$cond":[{"$eq":["$TT.lab.testId","covidAegisPCR"]},{"$numberInt":"1"},{"$numberInt":"0"}]}},"AegisSameDay":{"$sum":{"$cond":[{"$and":[{"$eq":["$TT.lab.testId","covidAegisPCR"]},"$sameDay"]},{"$numberInt":"1"},{"$numberInt":"0"}]}}}},{"$addFields":{"SiteNumber":"$_id.site","AppointmentDate":{"$dateToString":{"date":"$_id.date","format":"%Y-%m-%d"}}}},{"$unset":"_id"},{"$sort":{"State":{"$numberInt":"1"},"City":{"$numberInt":"1"},"SiteNumber":{"$numberInt":"1"},"AppointmentDate":{"$numberInt":"1"}}}],"paths":{"appointmentsFrom":["[0].$match['appointmentDate'].$gte"],"appointmentsTo":["[0].$match['appointmentDate'].$lt"]}}],"output":{"filename":"SameDayAppointmentSummary.{ISODateTime}.csv","batchSize":{"$numberInt":"5000"},"decryption":[],"fields":["SiteNumber","City","State","AppointmentDate","AllTotal","AllSameDay","IDNOWTotal","IDNOWSameDay","BinaxTotal","BinaxSameDay","LabCorpTotal","LabCorpSameDay","AegisTotal","AegisSameDay"]}}
{"_id":"VoucherClientReport","title":"Voucher Client Report","parameters":[],"rules":{},"plans":[{"driver":"covidClients","pipeline":[{"$lookup":{"from":"covidClients","localField":"_id","foreignField":"parentId","as":"CC"}},{"$match":{"CC.0":{"$exists":false}}},{"$graphLookup":{"from":"covidClients","startWith":"$_id","connectFromField":"parentId","connectToField":"_id","as":"CH","depthField":"depth"}},{"$unwind":{"path":"$CH","preserveNullAndEmptyArrays":true}},{"$sort":{"_id":{"$numberInt":"1"},"CH.depth":{"$numberInt":"-1"}}},{"$group":{"_id":"$_id","name":{"$first":"$name"},"total":{"$sum":{"$numberInt":"1"}},"hier":{"$push":"$CH"}}},{"$lookup":{"from":"covidVouchers","localField":"_id","foreignField":"client","as":"V"}},{"$unwind":{"path":"$V","preserveNullAndEmptyArrays":true}},{"$project":{"_id":{"$numberInt":"0"},"clientId":"$_id","orgPath":{"$reduce":{"input":"$hier.name","initialValue":"","in":{"$concat":["$$value",{"$cond":[{"$eq":["$$value",""]},""," > "]},"$$this"]}}},"levels":"$total","voucherId":"$V._id","planId":"$V.planId","groupId":"$V.groupId","effectStart":"$V.effectStart","effectEnd":"$V.effectEnd"}},{"$addFields":{"pathForSort":{"$toUpper":"$orgPath"}}},{"$sort":{"pathForSort":{"$numberInt":"1"},"planId":{"$numberInt":"1"},"groupId":{"$numberInt":"1"}}},{"$unset":["pathForSort"]}],"paths":{}}],"output":{"filename":"VoucherClientReport.{ISODateTime}.csv","batchSize":{"$numberInt":"5000"},"decryption":[],"fields":["clientId","orgPath","levels","voucherId","planId","groupId","effectStart","effectEnd"]}}
{"_id":"HBA1CResultsUniversal","title":"HBA1C Universal Results Report","parameters":[{"key":"resultsFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Results From","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"resultsTo","ui":{"ordinal":{"$numberInt":"2"},"label":"Results To","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}},{"key":"testingState","ui":{"ordinal":{"$numberInt":"5"},"label":"Testing State","control":"SelectOne","apitype":"String","source":{"type":"CommonList","list":"AllStates"}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"testingSite","ui":{"ordinal":{"$numberInt":"6"},"label":"Testing Site","control":"SelectOne","apitype":"String","source":{"type":"DependentList","list":"SitesByState","parent":"testingState"}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"clinicPartner","ui":{"ordinal":{"$numberInt":"7"},"label":"Clinical Partner","control":"SelectOne","apitype":"String","source":{"type":"Inline","options":[{"text":"PWN"},{"text":"Walgreens"}]}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"labPartner","ui":{"ordinal":{"$numberInt":"8"},"label":"Lab Partner","control":"SelectOne","apitype":"String","source":{"type":"Inline","options":[{"text":"Abbott"},{"text":"LabCorp"},{"text":"Aegis"}]}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"patientState","ui":{"ordinal":{"$numberInt":"9"},"label":"Patient State","control":"SelectOne","apitype":"String","source":{"type":"CommonList","list":"AllStates"}},"service":{"type":"ExactString","encryptionTag":{"$numberInt":"1"}},"validation":{"required":false}},{"key":"voucherPlanId","ui":{"ordinal":{"$numberInt":"3"},"label":"Voucher Plan ID","control":"FreeText","apitype":"String"},"service":{"type":"UpperString"},"validation":{"required":false}},{"key":"voucherGroupId","ui":{"ordinal":{"$numberInt":"4"},"label":"Voucher Group ID","control":"FreeText","apitype":"String"},"service":{"type":"UpperString"},"validation":{"required":false}}],"rules":{"resultDateRangeStandard":{"trigger":{"noneOf":["voucherPlanId","voucherGroupId"]},"type":"DateSpan","dateFrom":"resultsFrom","dateTo":"resultsTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"30"}},"message":"Date range for a non-voucher results report must span at least one day and not more than 31 days."},"resultDateRangeVoucher":{"trigger":{"anyOf":["voucherPlanId","voucherGroupId"]},"type":"DateSpan","dateFrom":"resultsFrom","dateTo":"resultsTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"365"}},"message":"Date range for a voucher results report must span at least one day and not more than one year."}},"plans":[{"condition":{"anyOf":["voucherPlanId","voucherGroupId"]},"driver":"covidVouchers","pipeline":[{"$match":{"planId":null,"groupId":null}},{"$lookup":{"from":"covidTestTracking","localField":"_id","foreignField":"voucher.vid","as":"TT"}},{"$unwind":{"path":"$TT"}},{"$lookup":{"from":"covidTestResults","localField":"TT._id","foreignField":"engagementId","as":"TR"}},{"$unwind":{"path":"$TR"}},{"$match":{"TR.result.recordedDate":{"$gte":null,"$lt":null},"TR.labPartner":null,"TR.clinicPartner":null,"TR.storeNumber":null,"TR.testId":"A1CNowSelf"}},{"$lookup":{"from":"covidTestSites","localField":"TR.storeNumber","foreignField":"storeNumber","as":"TS"}},{"$unwind":{"path":"$TS"}},{"$match":{"TS.address.state":null}},{"$lookup":{"from":"userProfiles","localField":"TR.patientId","foreignField":"patientInfo.patientId","as":"UP"}},{"$unwind":{"path":"$UP"}},{"$match":{"UP.patientInfo.contact.address.state":null}},{"$unwind":{"path":"$UP.patientInfo"}},{"$match":{"$expr":{"$eq":["$TR.patientId","$UP.patientInfo.patientId"]},"UP.patientInfo.contact.address.state":null}},{"$lookup":{"from":"covidVoucherMembers","localField":"TT.voucher.mid","foreignField":"_id","as":"VM"}},{"$unwind":{"path":"$VM","preserveNullAndEmptyArrays":true}},{"$project":{"_id":{"$numberInt":"0"},"result":{"orderId":"$TR.orderId","collectionDate":"$TR.result.collectionDate","expirationDate":"$TR.result.expirationDate","lotNumber":"$TR.result.lotNumber","recordedValue":"$TR.result.recordedValue","teamMemberInitials":"$TR.source.teamMemberInitials"},"site":{"storeNumber":"$TS.storeNumber","siteNPI":"$TS.siteNPI"},"patient":{"firstName":"$UP.patientInfo.firstName","lastName":"$UP.patientInfo.lastName","dob":"$UP.patientInfo.dob","gender":"$UP.patientInfo.gender"},"voucher":{"accessCode":"$VM.accessCode"},"testingModel":{"testName":"$TM.moniker","loinc":"$TM.loinc.testType"}}}],"paths":{"voucherPlanId":["[0].$match.planId"],"voucherGroupId":["[0].$match.groupId"],"testingState":["[8].$match['TS.address.state']"],"testingSite":["[5].$match['TR.storeNumber']"],"clinicPartner":["[5].$match['TR.clinicPartner']"],"labPartner":["[5].$match['TR.labPartner']"],"patientState":["[11].$match['UP.patientInfo.contact.address.state']","[13].$match['UP.patientInfo.contact.address.state']"],"resultsFrom":["[5].$match['TR.result.recordedDate'].$gte"],"resultsTo":["[5].$match['TR.result.recordedDate'].$lt"]}},{"condition":{},"driver":"covidTestResults","pipeline":[{"$match":{"result.recordedDate":{"$gte":null,"$lt":null},"labPartner":null,"clinicPartner":null,"storeNumber":null,"testId":"A1CNowSelf"}},{"$lookup":{"from":"covidTestSites","localField":"storeNumber","foreignField":"storeNumber","as":"TS"}},{"$unwind":{"path":"$TS"}},{"$match":{"TS.address.state":null}},{"$lookup":{"from":"covidTestTracking","localField":"engagementId","foreignField":"_id","as":"TT"}},{"$unwind":{"path":"$TT"}},{"$lookup":{"from":"userProfiles","localField":"patientId","foreignField":"patientInfo.patientId","as":"UP"}},{"$unwind":{"path":"$UP"}},{"$match":{"UP.patientInfo.contact.address.state":null}},{"$unwind":{"path":"$UP.patientInfo"}},{"$match":{"$expr":{"$eq":["$patientId","$UP.patientInfo.patientId"]},"UP.patientInfo.contact.address.state":null}},{"$lookup":{"from":"covidVouchers","localField":"TT.voucher.vid","foreignField":"_id","as":"V"}},{"$unwind":{"path":"$V","preserveNullAndEmptyArrays":true}},{"$lookup":{"from":"covidVoucherMembers","localField":"TT.voucher.mid","foreignField":"_id","as":"VM"}},{"$unwind":{"path":"$VM","preserveNullAndEmptyArrays":true}},{"$lookup":{"from":"covidTestModels","localField":"testId","foreignField":"_id","as":"TM"}},{"$unwind":{"path":"$TM","preserveNullAndEmptyArrays":true}},{"$project":{"_id":{"$numberInt":"0"},"result":{"orderId":"$orderId","collectionDate":"$result.collectionDate","expirationDate":"$result.expirationDate","lotNumber":"$result.lotNumber","recordedValue":"$result.recordedValue","teamMemberInitials":{"$substrCP":[{"$reduce":{"input":"$source.teamMemberInitials","initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]}},"site":{"storeNumber":"$TS.storeNumber","siteNPI":"$TS.siteNPI"},"patient":{"firstName":"$UP.patientInfo.firstName","lastName":"$UP.patientInfo.lastName","dob":"$UP.patientInfo.dob","gender":"$UP.patientInfo.gender"},"voucher":{"accessCode":"$VM.accessCode"},"testingModel":{"testName":"$TM.moniker","loinc":"$TM.loinc.testType"}}}],"paths":{"testingState":["[3].$match['TS.address.state']"],"testingSite":["[0].$match.storeNumber"],"clinicPartner":["[0].$match.clinicPartner"],"labPartner":["[0].$match.labPartner"],"patientState":["[8].$match['UP.patientInfo.contact.address.state']","[10].$match['UP.patientInfo.contact.address.state']"],"resultsFrom":["[0].$match['result.recordedDate'].$gte"],"resultsTo":["[0].$match['result.recordedDate'].$lt"]}}],"output":{"filename":"ResultsReport.{ISODateTime}.csv","decryption":[{"fieldName":"result.normalizedValue","encryptionTag":{"$numberInt":"1"}},{"fieldName":"result.recordedValue","encryptionTag":{"$numberInt":"1"}},{"fieldName":"result.lotNumber","encryptionTag":{"$numberInt":"1"}},{"fieldName":"result.snomedCode","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.firstName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.lastName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.dob","encryptionTag":{"$numberInt":"5"}},{"fieldName":"patient.gender","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.race","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.ethnicity","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressLine1","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressLine2","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressCity","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressState","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressZIP","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.phone","encryptionTag":{"$numberInt":"2"}}],"fields":["voucher.accessCode","patient.firstName","patient.lastName","patient.dob","patient.gender","site.siteNPI","site.storeNumber","result.collectionDate","testingModel.loinc","result.recordedValue","result.lotNumber","result.expirationDate","result.orderId","result.teamMemberInitials","testingModel.testName"],"batchSize":{"$numberInt":"5000"}}}
{"_id":"InsuranceReport","title":"Patient Insurance Report","parameters":[{"key":"recordedDateFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Recorded Date From","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"recordedDateTo","ui":{"ordinal":{"$numberInt":"2"},"label":"Recorded Date To","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}}],"rules":{"recordedDateRange":{"type":"DateSpan","dateFrom":"recordedDateFrom","dateTo":"recordedDateTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"29"}},"message":"Date range must span at least one day and not more than 30 days."}},"plans":[{"driver":"covidTestResults","pipeline":[{"$match":{"result.recordedDate":{"$gte":null,"$lt":null}}},{"$lookup":{"from":"insuranceCoverage","localField":"engagementId","foreignField":"engagementId","as":"IC"}},{"$unwind":{"path":"$IC","preserveNullAndEmptyArrays":true}},{"$lookup":{"from":"userProfiles","localField":"patientId","foreignField":"patientInfo.patientId","as":"patient"}},{"$unwind":{"path":"$patient","preserveNullAndEmptyArrays":true}},{"$unwind":{"path":"$patient.patientInfo","preserveNullAndEmptyArrays":true}},{"$addFields":{"patientIdMatch":{"$eq":["$patientId","$patient.patientInfo.patientId"]},"patient.patientInfo.address":"$patient.patientInfo.contact.address","patient.patientInfo.phone":{"$first":"$patient.patientInfo.contact.phones.number"}}},{"$match":{"patientIdMatch":true}},{"$project":{"createDate":{"$numberInt":"1"},"partnerOrderId":"$orderId","resultDate":"$result.recordedDate","resultUpdateDate":"$updateDate","PI":"$IC.plans.primary","primaryRelationship":"$IC.plans.primary.relationship","hasinsurance":"$IC.hasInsurance","primaryPolicyHolder":{"$cond":{"if":{"$eq":["$IC.plans.primary.relationship","1"]},"then":"$patient.patientInfo","else":"$IC.plans.primary.policyholder"}},"SI":"$IC.plans.secondary","secondaryPolicyHolder":{"$cond":{"if":{"$eq":["$IC.plans.secondary.relationship","1"]},"then":"$patient.patientInfo","else":"$IC.plans.secondary.policyholder"}},"Uninsured.stateIdState":"$IC.stateIdState","Uninsured.stateIdNumber":"$IC.stateIdNumber"}},{"$project":{"createDate":{"$numberInt":"1"},"partnerOrderId":{"$numberInt":"1"},"resultDate":{"$numberInt":"1"},"resultUpdateDate":{"$numberInt":"1"},"hasinsurance":{"$numberInt":"1"},"Uninsured":{"$numberInt":"1"},"primaryInsurance.CarrierName":"$PI.companyName","primaryInsurance.CarrierCode":"$PI.carrierCode","primaryInsurance.PayerAddress1":"$PI.companyAddress.line1","primaryInsurance.PayerAddress2":"$PI.companyAddress.line2","primaryInsurance.PayerCity":"$PI.companyAddress.city","primaryInsurance.PayerST":"$PI.companyAddress.state","primaryInsurance.PayerZIP":"$PI.companyAddress.zip","primaryInsurance.GroupNumber":"$PI.groupNumber","primaryInsurance.PolicyName":"$PI.policyName","primaryInsurance.MemberID":"$PI.policyNumber","primaryInsurance.GroupEmployerName":"$PI.groupEmployerName","primaryInsurance.NatPayerID":"$PI.nationalPayerId","primaryInsurance.PayerID":"$PI.payerId","primaryPolicyHolder":{"$numberInt":"1"},"secondaryInsurance.CarrierName":"$SI.companyName","secondaryInsurance.CarrierCode":"$SI.carrierCode","secondaryInsurance.PayerAddress1":"$SI.companyAddress.line1","secondaryInsurance.PayerAddress2":"$SI.companyAddress.line2","secondaryInsurance.PayerCity":"$SI.companyAddress.city","secondaryInsurance.PayerST":"$SI.companyAddress.state","secondaryInsurance.PayerZIP":"$SI.companyAddress.zip","secondaryInsurance.GroupNumber":"$SI.groupNumber","secondaryInsurance.PolicyName":"$SI.policyName","secondaryInsurance.MemberID":"$SI.policyNumber","secondaryInsurance.GroupEmployerName":"$SI.groupEmployerName","secondaryInsurance.NatPayerID":"$SI.nationalPayerId","secondaryInsurance.PayerID":"$SI.payerId","secondaryPolicyHolder":{"$numberInt":"1"}}},{"$limit":{"$numberInt":"1000000"}}],"paths":{"recordedDateFrom":["[0].$match['result.recordedDate'].$gte"],"recordedDateTo":["[0].$match['result.recordedDate'].$lt"]}}],"output":{"filename":"InsuranceReport.{ISODateTime}.csv","batchSize":{"$numberInt":"5000"},"decryption":[{"fieldName":"Uninsured.stateIdNumber","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryInsurance.GroupNumber","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryInsurance.MemberID","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryInsurance.GroupEmployerName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryInsurance.PolicyName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.firstName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.lastName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.dob","encryptionTag":{"$numberInt":"5"}},{"fieldName":"primaryPolicyHolder.gender","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.address.line1","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.address.line2","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.address.city","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.address.state","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.address.zip","encryptionTag":{"$numberInt":"1"}},{"fieldName":"primaryPolicyHolder.phone","encryptionTag":{"$numberInt":"2"}},{"fieldName":"secondaryInsurance.GroupNumber","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryInsurance.MemberID","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryInsurance.GroupEmployerName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryInsurance.PolicyName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.firstName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.lastName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.dob","encryptionTag":{"$numberInt":"5"}},{"fieldName":"secondaryPolicyHolder.gender","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.address.line1","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.address.line2","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.address.city","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.address.state","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.address.zip","encryptionTag":{"$numberInt":"1"}},{"fieldName":"secondaryPolicyHolder.phone","encryptionTag":{"$numberInt":"2"}}],"fields":["createDate","partnerOrderId","resultDate","resultUpdateDate","hasinsurance","primaryInsurance.CarrierName","primaryInsurance.CarrierCode","primaryInsurance.PayerAddress1","primaryInsurance.PayerAddress2","primaryInsurance.PayerCity","primaryInsurance.PayerST","primaryInsurance.PayerZIP","primaryInsurance.GroupNumber","primaryInsurance.PolicyName","primaryInsurance.MemberID","primaryInsurance.GroupEmployerName","primaryInsurance.NatPayerID","primaryInsurance.PayerID","primaryPolicyHolder.firstName","primaryPolicyHolder.lastName","primaryPolicyHolder.dob","primaryPolicyHolder.gender","primaryPolicyHolder.phone","primaryPolicyHolder.address.line1","primaryPolicyHolder.address.line2","primaryPolicyHolder.address.city","primaryPolicyHolder.address.state","primaryPolicyHolder.address.zip","primaryPolicyHolder.phone","secondaryInsurance.CarrierName","secondaryInsurance.CarrierCode","secondaryInsurance.PayerAddress1","secondaryInsurance.PayerAddress2","secondaryInsurance.PayerCity","secondaryInsurance.PayerST","secondaryInsurance.PayerZIP","secondaryInsurance.GroupNumber","secondaryInsurance.PolicyName","secondaryInsurance.MemberID","secondaryInsurance.GroupEmployerName","secondaryInsurance.NatPayerID","secondaryInsurance.PayerID","secondaryPolicyHolder.firstName","secondaryPolicyHolder.lastName","secondaryPolicyHolder.dob","secondaryPolicyHolder.gender","secondaryPolicyHolder.phone","secondaryPolicyHolder.address.line1","secondaryPolicyHolder.address.line2","secondaryPolicyHolder.address.city","secondaryPolicyHolder.address.state","secondaryPolicyHolder.address.zip","secondaryPolicyHolder.phone","Uninsured.stateIdState","Uninsured.stateIdNumber"]}}
{"_id":"otcInsuranceCoveredReport","title":"Orders for insured Covid test kits","parameters":[{"key":"createDateFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Create Date From","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"createDateTo","ui":{"ordinal":{"$numberInt":"2"},"label":"Create Date To","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}}],"rules":{"createDateRange":{"type":"DateSpan","dateFrom":"createDateFrom","dateTo":"createDateTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"29"}},"message":"Date range must span at least one day and not more than 30 days."}},"plans":[{"driver":"otcOrderTracking","pipeline":[{"$match":{"createDate":{"$gte":null,"$lt":null}}},{"$project":{"Collection ID":"$_id","Transaction ID":"$orderInfo.transactionId","Transaction status":"$result.value","Store number":"$orderInfo.store.storeNumber","Order date":"$createDate","Test quantity":"$orderInfo.quantity","Fax number":"$orderInfo.store.storeNumber","Patient first name":"$patientInfo.firstName","Patient last name":"$patientInfo.lastName","Patient date of birth":"$patientInfo.dob","Patient phone":"$patientInfo.phone","Patient address":{"$concat":["$patientInfo.address.line1"," ","$patientInfo.address.line2"]},"Patient city":"$patientInfo.address.city","Patient state":"$patientInfo.address.state","Patient zip":"$patientInfo.address.zip","Result Description":"$result.description"}},{"$limit":{"$numberInt":"1000000"}}],"paths":{"createDateFrom":["[0].$match['createDate'].$gte"],"createDateTo":["[0].$match['createDate'].$lt"]}}],"output":{"filename":"otcInsuranceCoveredReport.{ISODateTime}.csv","batchSize":{"$numberInt":"5000"},"decryption":[{"fieldName":"Patient first name","encryptionTag":{"$numberInt":"1"}},{"fieldName":"Patient last name","encryptionTag":{"$numberInt":"1"}},{"fieldName":"Patient date of birth","encryptionTag":{"$numberInt":"5"}},{"fieldName":"Patient phone","encryptionTag":{"$numberInt":"2"}},{"fieldName":"Patient address","encryptionTag":{"$numberInt":"1"}},{"fieldName":"Patient city","encryptionTag":{"$numberInt":"1"}},{"fieldName":"Patient state","encryptionTag":{"$numberInt":"1"}},{"fieldName":"Patient zip","encryptionTag":{"$numberInt":"1"}}],"fields":["Collection ID","Transaction ID","Transaction status","Store number","Order date","Test quantity","Fax number","Patient first name","Patient last name","Patient date of birth","Patient phone","Patient address","Patient city","Patient state","Patient zip","Result Description"]}}
{"_id":"UnresultedAppointments","title":"Unresulted Appointments Report","parameters":[{"key":"appointmentsFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Appointments From","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"appointmentsTo","ui":{"ordinal":{"$numberInt":"2"},"label":"Appointments To","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}}],"rules":{"appointmentDateRange":{"type":"DateSpan","dateFrom":"appointmentsFrom","dateTo":"appointmentsTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"30"}},"message":"Date range must span at least one day and not more than 31 days."}},"plans":[{"driver":"covidTestAppointments","pipeline":[{"$match":{"appointmentDate":{"$gte":null,"$lt":null},"appointments.appointmentStatus":{"$in":["Booked","Cancelled"]}}},{"$unwind":{"path":"$appointments"}},{"$match":{"appointments.appointmentStatus":{"$in":["Booked","Cancelled"]}}},{"$lookup":{"from":"covidTestResults","localField":"appointments.engagementId","foreignField":"engagementId","as":"TR"}},{"$match":{"TR.0":{"$exists":false}}},{"$lookup":{"from":"covidTestTracking","localField":"appointments.engagementId","foreignField":"_id","as":"TT"}},{"$unwind":{"path":"$TT"}},{"$lookup":{"from":"userProfiles","localField":"appointments.patientId","foreignField":"patientInfo.patientId","as":"UP"}},{"$unwind":{"path":"$UP"}},{"$unwind":{"path":"$UP.patientInfo"}},{"$match":{"$expr":{"$eq":["$appointments.patientId","$UP.patientInfo.patientId"]}}},{"$lookup":{"from":"covidTestSites","localField":"storeNumber","foreignField":"storeNumber","as":"TS"}},{"$unwind":{"path":"$TS"}},{"$project":{"_id":{"$numberInt":"0"},"appointment":{"id":"$appointments.appointmentId","date":{"$dateToString":{"date":"$appointmentDate","format":"%Y-%m-%d"}},"slot":"$timeSlot","status":"$appointments.appointmentStatus"},"engagement":{"id":"$TT._id","orderId":"$TT.partnerOrderId","orderStatus":"$TT.partnerDecision","confirmCode":"$TT.partnerConfirmationCode","testType":"$TT.lab.testId","isCashPay":"$TT.isCashPay","isMedicallyNecessary":"$TT.isMedicallyNecessary"},"patient":{"id":"$UP.patientInfo.patientId","firstName":"$UP.patientInfo.firstName","lastName":"$UP.patientInfo.lastName","dob":"$UP.patientInfo.dob","phone":{"$arrayElemAt":["$UP.patientInfo.contact.phones.number",{"$numberInt":"0"}]},"email":{"$arrayElemAt":["$UP.patientInfo.contact.emails.address",{"$numberInt":"0"}]}},"site":{"storeNumber":"$TS.storeNumber","street":"$TS.address.street","city":"$TS.address.city","state":"$TS.address.state","zip":"$TS.address.zip"}}}],"paths":{"appointmentsFrom":["[0].$match['appointmentDate'].$gte"],"appointmentsTo":["[0].$match['appointmentDate'].$lt"]}}],"output":{"filename":"UnresultedAppointments.{ISODateTime}.csv","decryption":[{"fieldName":"patient.firstName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.lastName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.dob","encryptionTag":{"$numberInt":"5"}},{"fieldName":"patient.phone","encryptionTag":{"$numberInt":"2"}},{"fieldName":"patient.email","encryptionTag":{"$numberInt":"3"}}],"fields":["appointment.id","appointment.date","appointment.slot","appointment.status","engagement.id","engagement.orderId","engagement.orderStatus","engagement.confirmCode","engagement.testType","engagement.isCashPay","engagement.isMedicallyNecessary","patient.id","patient.firstName","patient.lastName","patient.dob","patient.phone","patient.email","site.storeNumber","site.street","site.city","site.state","site.zip"]}}
{"_id":"CurbsidePatientReport","title":"Curbside Pickup","parameters":[{"key":"encountersFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Start Date","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"encountersTo","ui":{"ordinal":{"$numberInt":"2"},"label":"End Date","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}}],"rules":{"appointmentDateRange":{"type":"DateSpan","dateFrom":"encountersFrom","dateTo":"encountersTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"30"}},"message":"Date range must span at least one day and not more than 30 days."}},"plans":[{"driver":"curbsideOrderTracking","pipeline":[{"$match":{"createDate":{"$gte":null,"$lt":null},"orderInfo.tracking.orderStatus":"Submitted"}},{"$addFields":{"covidPositiveLast90Days":{"$ifNull":[{"$indexOfArray":["$screeningAnswers.name","questionCovidPositiveLast90Days"]},{"$numberInt":"-1"}]}}},{"$project":{"_id":{"$numberInt":"0"},"orderNumber":"$orderInfo.tracking.orderNumber","orderDate":"$createDate","storeNumber":"$orderInfo.store.storeNumber","patientFirstName":"$patientInfo.firstName","patientLastName":"$patientInfo.lastName","patientDateOfBirth":"$patientInfo.dob","patientPhoneNumber":"$patientInfo.phone","patientState":"$patientInfo.address.state","patientZipCode":"$patientInfo.address.zip","patientEthnicity":"$patientInfo.ethnicity","patientRace":"$patientInfo.race","patientSex":"$patientInfo.gender","isPregnant":{"$arrayElemAt":["$screeningAnswers.displayValue",{"$indexOfArray":["$screeningAnswers.name","questionPregnant"]}]},"currentSymptoms":{"$let":{"vars":{"q0":{"$arrayElemAt":["$screeningAnswers",{"$numberInt":"0"}]}},"in":"$$q0.displayValue"}},"vaccinationStatus":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionIsVaccineReceived"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"firstVaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineTypeFirstDose"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"firstVaccineDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionFirstDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"secondVaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineTypeSecondDose"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"secondVaccineDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionSecondDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"thirdVaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineTypeThirdDose"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"thirdVaccineDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionThirdDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"fourthVaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineTypeFourthDose"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"fourthVaccineDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionFourthDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"fifthVaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineTypeFifthDose"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"fifthVaccineDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionFifthDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"sixthVaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineTypeSixthDose"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"sixthVaccineDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionSixthDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"twoWeeksSinceMostRecentDose":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionTwoWeeksSinceMostRecentDose"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"recentContactCOVID":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionRecentContactCOVID"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"riskConditions":{"$substrCP":[{"$reduce":{"input":{"$arrayElemAt":["$screeningAnswers.value",{"$indexOfArray":["$screeningAnswers.name","questionRiskConditions"]}]},"initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]},"testReasonPastOrFutureTravel":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionTestReasonPastOrFutureTravel"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"howManyVaccinesReceived":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$screeningAnswers","cond":{"$eq":["$$this.name","questionHowManyVaccinesReceived"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"covidPositiveWithinLast90Days":{"$cond":[{"$eq":["$covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$screeningAnswers.value","$covidPositiveLast90Days"]},"covidPositiveWithinLast90Days"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositivePriorTo90Days":{"$cond":[{"$eq":["$covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$screeningAnswers.value","$covidPositiveLast90Days"]},"covidPositivePriorToLast90Days"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveLastWeek":{"$cond":[{"$eq":["$covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$screeningAnswers.value","$covidPositiveLast90Days"]},"covidPositiveLastWeek"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveWeekThreeMonths":{"$cond":[{"$eq":["$covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$screeningAnswers.value","$covidPositiveLast90Days"]},"covidPositiveWeekThreeMonths"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveMoreThanThreeMonths":{"$cond":[{"$eq":["$covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$screeningAnswers.value","$covidPositiveLast90Days"]},"covidPositiveMoreThanThreeMonths"]},{"$numberInt":"-1"}]},null,"Yes"]}]}}}],"paths":{"encountersFrom":["[0].$match['createDate'].$gte"],"encountersTo":["[0].$match['createDate'].$lt"]}}],"output":{"filename":"CurbsidePickup.{ISODateTime}.csv","decryption":[{"fieldName":"patientFirstName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patientLastName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patientDateOfBirth","encryptionTag":{"$numberInt":"5"}},{"fieldName":"patientPhoneNumber","encryptionTag":{"$numberInt":"2"}},{"fieldName":"patientState","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patientZipCode","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patientEthnicity","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patientRace","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patientSex","encryptionTag":{"$numberInt":"1"}}],"fields":["orderDate","orderNumber","storeNumber","patientFirstName","patientLastName","patientDateOfBirth","patientPhoneNumber","patientState","patientZipCode","patientEthnicity","patientRace","patientSex","isPregnant","currentSymptoms","vaccinationStatus","firstVaccineType","firstVaccineDate","secondVaccineType","secondVaccineDate","thirdVaccineType","thirdVaccineDate","fourthVaccineType","fourthVaccineDate","fifthVaccineType","fifthVaccineDate","sixthVaccineType","sixthVaccineDate","twoWeeksSinceMostRecentDose","recentContactCOVID","riskConditions","testReasonPastOrFutureTravel","howManyVaccinesReceived","covidPositiveWithinLast90Days","covidPositivePriorTo90Days","covidPositiveLastWeek","covidPositiveWeekThreeMonths","covidPositiveMoreThanThreeMonths"]}}
{"_id":"FCProfileConsentIdentifiers","title":"FCProfile Consent Identifiers","parameters":[],"rules":{},"plans":[{"driver":"userConsents","pipeline":[{"$match":{"category":"findcare","type":"findcareProfile","termsAndAgreementId":"6021b1dd15668a261cb6d9ff"}},{"$unwind":{"path":"$identifier"}},{"$sort":{"createDateTime":{"$numberInt":"-1"}}},{"$group":{"_id":"$identifier.value","latestActive":{"$first":"$isActive"},"latestCreateDate":{"$first":"$createDateTime"}}},{"$match":{"latestActive":true}},{"$project":{"_id":{"$numberInt":"0"},"accountId":"$_id","consentCreateDate":"$latestCreateDate"}}],"paths":{}}],"output":{"filename":"FCProfileConsentIdentifiers.{ISODateTime}.csv","batchSize":{"$numberInt":"5000"},"decryption":[{"fieldName":"accountId","encryptionTag":{"$numberInt":"1"}}],"fields":["accountId","consentCreateDate"]}}
{"_id":"ResultsUniversal2","title":"Universal Results Report","parameters":[{"key":"resultsFrom","ui":{"ordinal":{"$numberInt":"1"},"label":"Results From","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS"},"validation":{"required":true}},{"key":"resultsTo","ui":{"ordinal":{"$numberInt":"2"},"label":"Results To","control":"DatePick","apitype":"ISODate"},"service":{"type":"ISODateStringToJS","transform":"return new Date(arg.getTime() + 86400000)"},"validation":{"required":true}},{"key":"testingState","ui":{"ordinal":{"$numberInt":"5"},"label":"Testing State","control":"SelectOne","apitype":"String","source":{"type":"CommonList","list":"AllStates"}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"testingSite","ui":{"ordinal":{"$numberInt":"6"},"label":"Testing Site","control":"SelectOne","apitype":"String","source":{"type":"DependentList","list":"SitesByState","parent":"testingState"}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"clinicPartner","ui":{"ordinal":{"$numberInt":"7"},"label":"Clinical Partner","control":"SelectOne","apitype":"String","source":{"type":"Inline","options":[{"text":"PWN"},{"text":"Walgreens"}]}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"labPartner","ui":{"ordinal":{"$numberInt":"8"},"label":"Lab Partner","control":"SelectOne","apitype":"String","source":{"type":"Inline","options":[{"text":"Abbott"},{"text":"LabCorp"},{"text":"Aegis"}]}},"service":{"type":"ExactString"},"validation":{"required":false}},{"key":"patientState","ui":{"ordinal":{"$numberInt":"9"},"label":"Patient State","control":"SelectOne","apitype":"String","source":{"type":"CommonList","list":"AllStates"}},"service":{"type":"ExactString","encryptionTag":{"$numberInt":"1"}},"validation":{"required":false}},{"key":"testType","ui":{"ordinal":{"$numberInt":"10"},"label":"Test Type","control":"SelectMultiple","apitype":"String","source":{"type":"CommonList"}},"service":{"type":"Object"},"validation":{"required":false}},{"key":"voucherPlanId","ui":{"ordinal":{"$numberInt":"3"},"label":"Voucher Plan ID","control":"FreeText","apitype":"String"},"service":{"type":"UpperString"},"validation":{"required":false}},{"key":"voucherGroupId","ui":{"ordinal":{"$numberInt":"4"},"label":"Voucher Group ID","control":"FreeText","apitype":"String"},"service":{"type":"UpperString"},"validation":{"required":false}}],"rules":{"resultDateRangeStandard":{"trigger":{"noneOf":["voucherPlanId","voucherGroupId"]},"type":"DateSpan","dateFrom":"resultsFrom","dateTo":"resultsTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"30"}},"message":"Date range for a non-voucher results report must span at least one day and not more than 31 days."},"resultDateRangeVoucher":{"trigger":{"anyOf":["voucherPlanId","voucherGroupId"]},"type":"DateSpan","dateFrom":"resultsFrom","dateTo":"resultsTo","min":{"value":{"$numberInt":"0"}},"max":{"value":{"$numberInt":"365"}},"message":"Date range for a voucher results report must span at least one day and not more than one year."}},"plans":[{"condition":{"anyOf":["voucherPlanId","voucherGroupId"]},"driver":"covidVouchers","pipeline":[{"$match":{"planId":null,"groupId":null}},{"$lookup":{"from":"covidTestTracking","localField":"_id","foreignField":"voucher.vid","as":"TT"}},{"$unwind":{"path":"$TT"}},{"$lookup":{"from":"covidTestResults","localField":"TT._id","foreignField":"engagementId","as":"TR"}},{"$unwind":{"path":"$TR"}},{"$match":{"TR.result.recordedDate":{"$gte":null,"$lt":null},"TR.labPartner":null,"TR.clinicPartner":null,"TR.storeNumber":null,"TR.testId":null}},{"$lookup":{"from":"covidTestSites","localField":"TR.storeNumber","foreignField":"storeNumber","as":"TS"}},{"$unwind":{"path":"$TS"}},{"$match":{"TS.address.state":null}},{"$lookup":{"from":"userProfiles","localField":"TR.patientId","foreignField":"patientInfo.patientId","as":"UP"}},{"$unwind":{"path":"$UP"}},{"$match":{"UP.patientInfo.contact.address.state":null}},{"$unwind":{"path":"$UP.patientInfo"}},{"$match":{"$expr":{"$eq":["$TR.patientId","$UP.patientInfo.patientId"]},"UP.patientInfo.contact.address.state":null}},{"$lookup":{"from":"covidVoucherMembers","localField":"TT.voucher.mid","foreignField":"_id","as":"VM"}},{"$unwind":{"path":"$VM","preserveNullAndEmptyArrays":true}},{"$addFields":{"index":{"recentContactCOVID19":{"$ifNull":[{"$indexOfArray":[{"$map":{"input":"$TT.screeningAnswers.name","as":"itemName","in":{"$substr":["$$itemName",{"$numberInt":"0"},{"$numberInt":"26"}]}}},"questionRecentContactCOVID"]},{"$numberInt":"-1"}]},"recentContactSickUnspecified":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionRecentContactSickUnspecified"]},{"$numberInt":"-1"}]},"recentExposures":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionRecentExposures"]},{"$numberInt":"-1"}]},"workSetting":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionWorkSetting"]},{"$numberInt":"-1"}]},"covidVaccinated":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionIsVaccineReceived"]},{"$numberInt":"-1"}]},"covidPastPositive":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionHaveTestedPositive"]},{"$numberInt":"-1"}]},"thirdDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionThirdDoseDate"]},{"$numberInt":"-1"}]},"fourthDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionFourthDoseDate"]},{"$numberInt":"-1"}]},"fifthDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionFifthDoseDate"]},{"$numberInt":"-1"}]},"sixthDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionSixthDoseDate"]},{"$numberInt":"-1"}]},"howManyVaccinesReceived":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionHowManyVaccinesReceived"]},{"$numberInt":"-1"}]},"vaccineTypeFirstDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeFirstDose"]},{"$numberInt":"-1"}]},"vaccineTypeSecondDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeSecondDose"]},{"$numberInt":"-1"}]},"vaccineTypeThirdDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeThirdDose"]},{"$numberInt":"-1"}]},"vaccineTypeFourthDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeFourthDose"]},{"$numberInt":"-1"}]},"vaccineTypeFifthDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeFifthDose"]},{"$numberInt":"-1"}]},"vaccineTypeSixthDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeSixthDose"]},{"$numberInt":"-1"}]},"twoWeeksSinceMostRecentDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionTwoWeeksSinceMostRecentDose"]},{"$numberInt":"-1"}]},"covidPositiveLast90Days":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionCovidPositiveLast90Days"]},{"$numberInt":"-1"}]},"testReasonPastOrFutureTravel":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionTestReasonPastOrFutureTravel"]},{"$numberInt":"-1"}]},"FluInterest":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluInterested"]},{"$numberInt":"-1"}]},"FluTakenAntiViral":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluMedications"]},{"$numberInt":"-1"}]},"FluTreatInterest":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluTreatment"]},{"$numberInt":"-1"}]},"FluTreatFlumist":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluMist"]},{"$numberInt":"-1"}]},"FluTreatPostPartum":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluGivenBirth"]},{"$numberInt":"-1"}]}}}},{"$project":{"_id":{"$numberInt":"0"},"result":{"resultId":{"$toString":"$TR._id"},"labPartner":"$TR.labPartner","clinicPartner":"$TR.clinicPartner","orderId":"$TR.orderId","normalizedValue":"$TR.result.normalizedValue","manualReason":"$TR.result.reason","covidAntiviral":{"$ifNull":["$TT.covidAntiviral",null]},"recordedDate":"$TR.result.recordedDate","snomedCode":"$TR.result.snomedCode","createDate":"$TR.createDate","updateDate":"$TR.updateDate"},"site":{"storeNumber":"$TS.storeNumber","cliaNumber":"$TS.clia.number","street":"$TS.address.street","city":"$TS.address.city","state":"$TS.address.state","zip":"$TS.address.zip","county":"$TS.address.county","status":"$TS.stationStatus","timeZone":"$TS.timeZoneIANA"},"engmt":{"engagementId":"$TT._id","engagementType":"$TT.type","confirmationCode":"$TT.partnerConfirmationCode","specimenSource":"$TT.lab.snomed.specimenSource","specimenType":"$TT.lab.snomed.specimenType","testType":"$TT.lab.loinc.testType","providerNPI":"$TT.clinic.provider.npi","providerFirstName":"$TT.clinic.provider.firstName","providerLastName":"$TT.clinic.provider.lastName","currentSymptoms":{"$let":{"vars":{"q0":{"$arrayElemAt":["$TT.screeningAnswers",{"$numberInt":"0"}]}},"in":"$$q0.displayValue"}},"recentContactCOVID":{"$cond":[{"$eq":["$index.recentContactCOVID19",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.recentContactCOVID19"]}]},"recentContactUnspecified":{"$cond":[{"$eq":["$index.recentContactSickUnspecified",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.recentContactSickUnspecified"]}]},"isPregnant":{"$arrayElemAt":["$TT.screeningAnswers.displayValue",{"$indexOfArray":["$TT.screeningAnswers.name","questionPregnant"]}]},"isMedicallyNecessary":"$TT.isMedicallyNecessary","isCashPay":"$TT.isCashPay","recentExposures":{"$cond":[{"$eq":["$index.recentExposures",{"$numberInt":"-1"}]},null,{"$substrCP":[{"$reduce":{"input":{"$arrayElemAt":["$TT.screeningAnswers.value","$index.recentExposures"]},"initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]}]},"workSetting":{"$cond":[{"$eq":["$index.workSetting",{"$numberInt":"-1"}]},null,{"$substrCP":[{"$reduce":{"input":{"$arrayElemAt":["$TT.screeningAnswers.value","$index.workSetting"]},"initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]}]},"riskConditions":{"$substrCP":[{"$reduce":{"input":{"$arrayElemAt":["$TT.screeningAnswers.value",{"$indexOfArray":["$TT.screeningAnswers.name","questionRiskConditions"]}]},"initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]},"vaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$TT.screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineType"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"firstDoseDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$TT.screeningAnswers","cond":{"$eq":["$$this.name","questionFirstDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"secondDoseDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$TT.screeningAnswers","cond":{"$eq":["$$this.name","questionSecondDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"covidVaccinated":{"$cond":[{"$eq":["$index.covidVaccinated",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.covidVaccinated"]}]},"covidPastPositive":{"$cond":[{"$eq":["$index.covidPastPositive",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.covidPastPositive"]}]},"thirdDoseDate":{"$cond":[{"$eq":["$index.thirdDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.thirdDoseDate"]}]},"fourthDoseDate":{"$cond":[{"$eq":["$index.fourthDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.fourthDoseDate"]}]},"fifthDoseDate":{"$cond":[{"$eq":["$index.fifthDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.fifthDoseDate"]}]},"sixthDoseDate":{"$cond":[{"$eq":["$index.sixthDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.sixthDoseDate"]}]},"howManyVaccinesReceived":{"$cond":[{"$eq":["$index.howManyVaccinesReceived",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.howManyVaccinesReceived"]}]},"vaccineTypeFirstDose":{"$cond":[{"$eq":["$index.vaccineTypeFirstDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeFirstDose"]}]},"vaccineTypeSecondDose":{"$cond":[{"$eq":["$index.vaccineTypeSecondDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeSecondDose"]}]},"vaccineTypeThirdDose":{"$cond":[{"$eq":["$index.vaccineTypeThirdDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeThirdDose"]}]},"vaccineTypeFourthDose":{"$cond":[{"$eq":["$index.vaccineTypeFourthDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeFourthDose"]}]},"vaccineTypeFifthDose":{"$cond":[{"$eq":["$index.vaccineTypeFifthDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeFifthDose"]}]},"vaccineTypeSixthDose":{"$cond":[{"$eq":["$index.vaccineTypeSixthDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeSixthDose"]}]},"twoWeeksSinceMostRecentDose":{"$cond":[{"$eq":["$index.twoWeeksSinceMostRecentDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.twoWeeksSinceMostRecentDose"]}]},"covidPositiveWithinLast90Days":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveWithinLast90Days"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositivePriorTo90Days":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositivePriorToLast90Days"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveLastWeek":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveLastWeek"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveWeekThreeMonths":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveWeekThreeMonths"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveMoreThanThreeMonths":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveMoreThanThreeMonths"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"testReasonPastOrFutureTravel":{"$cond":[{"$eq":["$index.testReasonPastOrFutureTravel",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.testReasonPastOrFutureTravel"]}]},"FluInterest":{"$cond":[{"$eq":["$index.FluInterest",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluInterest"]},"Yes"]},"Yes","No"]}]},"FluTakenAntiViral":{"$cond":[{"$eq":["$index.FluTakenAntiViral",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTakenAntiViral"]},"Yes"]},"Yes","No"]}]},"FluTreatInterest":{"$cond":[{"$eq":["$index.FluTreatInterest",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTreatInterest"]},"Yes"]},"Yes","No"]}]},"FluTreatFlumist":{"$cond":[{"$eq":["$index.FluTreatFlumist",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTreatFlumist"]},"Yes"]},"Yes","No"]}]},"FluTreatPostPartum":{"$cond":[{"$eq":["$index.FluTreatPostPartum",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTreatPostPartum"]},"Yes"]},"Yes","No"]}]}},"patient":{"patientId":"$UP.patientInfo.patientId","firstName":"$UP.patientInfo.firstName","lastName":"$UP.patientInfo.lastName","dob":"$UP.patientInfo.dob","gender":"$UP.patientInfo.gender","race":"$UP.patientInfo.race","ethnicity":"$UP.patientInfo.ethnicity","addressLine1":"$UP.patientInfo.contact.address.line1","addressLine2":"$UP.patientInfo.contact.address.line2","addressCity":"$UP.patientInfo.contact.address.city","addressState":"$UP.patientInfo.contact.address.state","addressZIP":"$UP.patientInfo.contact.address.zip","phone":{"$let":{"vars":{"phone0":{"$arrayElemAt":["$UP.patientInfo.contact.phones",{"$numberInt":"0"}]}},"in":"$$phone0.number"}}},"voucher":{"group":"$groupId","plan":"$planId","accessCode":"$VM.accessCode","consentAccept":"$TT.consents.patientInfoVoucher.accepted","consentDate":"$TT.consents.patientInfoVoucher.timestamp"}}},{"$addFields":{"engmt.FluTestQualified":{"$cond":[{"$eq":["$engmt.FluInterest",null]},null,{"$cond":[{"$and":[{"$eq":["$engmt.FluInterest","Yes"]},{"$eq":["$engmt.FluTakenAntiViral","No"]}]},"Yes","No"]}]},"engmt.FluTreatQualified":{"$cond":[{"$eq":["$engmt.FluTreatInterest",null]},null,{"$cond":[{"$and":[{"$eq":["$engmt.FluTreatInterest","Yes"]},{"$eq":["$engmt.FluTreatFlumist","No"]},{"$eq":["$engmt.FluTreatPostPartum","No"]}]},"Yes","No"]}]}}}],"paths":{"voucherPlanId":["[0].$match.planId"],"voucherGroupId":["[0].$match.groupId"],"testingState":["[8].$match['TS.address.state']"],"testingSite":["[5].$match['TR.storeNumber']"],"clinicPartner":["[5].$match['TR.clinicPartner']"],"labPartner":["[5].$match['TR.labPartner']"],"patientState":["[11].$match['UP.patientInfo.contact.address.state']","[13].$match['UP.patientInfo.contact.address.state']"],"resultsFrom":["[5].$match['TR.result.recordedDate'].$gte"],"resultsTo":["[5].$match['TR.result.recordedDate'].$lt"],"testType":["[5].$match['TR.testId']"]}},{"condition":{},"driver":"covidTestResults","pipeline":[{"$match":{"result.recordedDate":{"$gte":null,"$lt":null},"labPartner":null,"clinicPartner":null,"storeNumber":null,"testId":null}},{"$lookup":{"from":"covidTestSites","localField":"storeNumber","foreignField":"storeNumber","as":"TS"}},{"$unwind":{"path":"$TS"}},{"$match":{"TS.address.state":null}},{"$lookup":{"from":"covidTestTracking","localField":"engagementId","foreignField":"_id","as":"TT"}},{"$unwind":{"path":"$TT"}},{"$lookup":{"from":"userProfiles","localField":"patientId","foreignField":"patientInfo.patientId","as":"UP"}},{"$unwind":{"path":"$UP"}},{"$match":{"UP.patientInfo.contact.address.state":null}},{"$unwind":{"path":"$UP.patientInfo"}},{"$match":{"$expr":{"$eq":["$patientId","$UP.patientInfo.patientId"]},"UP.patientInfo.contact.address.state":null}},{"$lookup":{"from":"covidVouchers","localField":"TT.voucher.vid","foreignField":"_id","as":"V"}},{"$unwind":{"path":"$V","preserveNullAndEmptyArrays":true}},{"$lookup":{"from":"covidVoucherMembers","localField":"TT.voucher.mid","foreignField":"_id","as":"VM"}},{"$unwind":{"path":"$VM","preserveNullAndEmptyArrays":true}},{"$addFields":{"index":{"recentContactCOVID19":{"$ifNull":[{"$indexOfArray":[{"$map":{"input":"$TT.screeningAnswers.name","as":"itemName","in":{"$substr":["$$itemName",{"$numberInt":"0"},{"$numberInt":"26"}]}}},"questionRecentContactCOVID"]},{"$numberInt":"-1"}]},"recentContactSickUnspecified":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionRecentContactSickUnspecified"]},{"$numberInt":"-1"}]},"recentExposures":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionRecentExposures"]},{"$numberInt":"-1"}]},"workSetting":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionWorkSetting"]},{"$numberInt":"-1"}]},"covidVaccinated":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionIsVaccineReceived"]},{"$numberInt":"-1"}]},"covidPastPositive":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionHaveTestedPositive"]},{"$numberInt":"-1"}]},"thirdDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionThirdDoseDate"]},{"$numberInt":"-1"}]},"fourthDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionFourthDoseDate"]},{"$numberInt":"-1"}]},"fifthDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionFifthDoseDate"]},{"$numberInt":"-1"}]},"sixthDoseDate":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionSixthDoseDate"]},{"$numberInt":"-1"}]},"howManyVaccinesReceived":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionHowManyVaccinesReceived"]},{"$numberInt":"-1"}]},"vaccineTypeFirstDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeFirstDose"]},{"$numberInt":"-1"}]},"vaccineTypeSecondDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeSecondDose"]},{"$numberInt":"-1"}]},"vaccineTypeThirdDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeThirdDose"]},{"$numberInt":"-1"}]},"vaccineTypeFourthDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeFourthDose"]},{"$numberInt":"-1"}]},"vaccineTypeFifthDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeFifthDose"]},{"$numberInt":"-1"}]},"vaccineTypeSixthDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionVaccineTypeSixthDose"]},{"$numberInt":"-1"}]},"twoWeeksSinceMostRecentDose":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionTwoWeeksSinceMostRecentDose"]},{"$numberInt":"-1"}]},"covidPositiveLast90Days":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionCovidPositiveLast90Days"]},{"$numberInt":"-1"}]},"testReasonPastOrFutureTravel":{"$ifNull":[{"$indexOfArray":["$TT.screeningAnswers.name","questionTestReasonPastOrFutureTravel"]},{"$numberInt":"-1"}]},"FluInterest":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluInterested"]},{"$numberInt":"-1"}]},"FluTakenAntiViral":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluMedications"]},{"$numberInt":"-1"}]},"FluTreatInterest":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluTreatment"]},{"$numberInt":"-1"}]},"FluTreatFlumist":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluMist"]},{"$numberInt":"-1"}]},"FluTreatPostPartum":{"$ifNull":[{"$indexOfArray":["$TT.surveyAnswers.fluAntiviral.name","questionFluGivenBirth"]},{"$numberInt":"-1"}]}}}},{"$project":{"_id":{"$numberInt":"0"},"result":{"resultId":{"$toString":"$_id"},"labPartner":"$labPartner","clinicPartner":"$clinicPartner","orderId":"$orderId","normalizedValue":"$result.normalizedValue","manualReason":"$result.reason","covidAntiviral":{"$ifNull":["$TT.covidAntiviral",null]},"recordedDate":"$result.recordedDate","snomedCode":"$result.snomedCode","createDate":"$createDate","updateDate":"$updateDate"},"site":{"storeNumber":"$TS.storeNumber","cliaNumber":"$TS.clia.number","street":"$TS.address.street","city":"$TS.address.city","state":"$TS.address.state","zip":"$TS.address.zip","county":"$TS.address.county","status":"$TS.stationStatus","timeZone":"$TS.timeZoneIANA"},"engmt":{"engagementId":"$TT._id","engagementType":"$TT.type","confirmationCode":"$TT.partnerConfirmationCode","specimenSource":"$TT.lab.snomed.specimenSource","specimenType":"$TT.lab.snomed.specimenType","testType":"$TT.lab.loinc.testType","providerNPI":"$TT.clinic.provider.npi","providerFirstName":"$TT.clinic.provider.firstName","providerLastName":"$TT.clinic.provider.lastName","currentSymptoms":{"$let":{"vars":{"q0":{"$arrayElemAt":["$TT.screeningAnswers",{"$numberInt":"0"}]}},"in":"$$q0.displayValue"}},"recentContactCOVID":{"$cond":[{"$eq":["$index.recentContactCOVID19",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.recentContactCOVID19"]}]},"recentContactUnspecified":{"$cond":[{"$eq":["$index.recentContactSickUnspecified",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.recentContactSickUnspecified"]}]},"isPregnant":{"$arrayElemAt":["$TT.screeningAnswers.displayValue",{"$indexOfArray":["$TT.screeningAnswers.name","questionPregnant"]}]},"isMedicallyNecessary":"$TT.isMedicallyNecessary","isCashPay":"$TT.isCashPay","recentExposures":{"$cond":[{"$eq":["$index.recentExposures",{"$numberInt":"-1"}]},null,{"$substrCP":[{"$reduce":{"input":{"$arrayElemAt":["$TT.screeningAnswers.value","$index.recentExposures"]},"initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]}]},"workSetting":{"$cond":[{"$eq":["$index.workSetting",{"$numberInt":"-1"}]},null,{"$substrCP":[{"$reduce":{"input":{"$arrayElemAt":["$TT.screeningAnswers.value","$index.workSetting"]},"initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]}]},"riskConditions":{"$substrCP":[{"$reduce":{"input":{"$arrayElemAt":["$TT.screeningAnswers.value",{"$indexOfArray":["$TT.screeningAnswers.name","questionRiskConditions"]}]},"initialValue":"","in":{"$concat":["$$value",",","$$this"]}}},{"$numberInt":"1"},{"$numberInt":"1000"}]},"vaccineType":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$TT.screeningAnswers","cond":{"$eq":["$$this.name","questionVaccineType"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"firstDoseDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$TT.screeningAnswers","cond":{"$eq":["$$this.name","questionFirstDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"secondDoseDate":{"$let":{"vars":{"qa":{"$arrayElemAt":[{"$filter":{"input":"$TT.screeningAnswers","cond":{"$eq":["$$this.name","questionSecondDoseDate"]}}},{"$numberInt":"0"}]}},"in":"$$qa.displayValue"}},"covidVaccinated":{"$cond":[{"$eq":["$index.covidVaccinated",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.covidVaccinated"]}]},"covidPastPositive":{"$cond":[{"$eq":["$index.covidPastPositive",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.covidPastPositive"]}]},"thirdDoseDate":{"$cond":[{"$eq":["$index.thirdDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.thirdDoseDate"]}]},"fourthDoseDate":{"$cond":[{"$eq":["$index.fourthDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.fourthDoseDate"]}]},"fifthDoseDate":{"$cond":[{"$eq":["$index.fifthDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.fifthDoseDate"]}]},"sixthDoseDate":{"$cond":[{"$eq":["$index.sixthDoseDate",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.sixthDoseDate"]}]},"howManyVaccinesReceived":{"$cond":[{"$eq":["$index.howManyVaccinesReceived",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.howManyVaccinesReceived"]}]},"vaccineTypeFirstDose":{"$cond":[{"$eq":["$index.vaccineTypeFirstDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeFirstDose"]}]},"vaccineTypeSecondDose":{"$cond":[{"$eq":["$index.vaccineTypeSecondDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeSecondDose"]}]},"vaccineTypeThirdDose":{"$cond":[{"$eq":["$index.vaccineTypeThirdDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeThirdDose"]}]},"vaccineTypeFourthDose":{"$cond":[{"$eq":["$index.vaccineTypeFourthDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeFourthDose"]}]},"vaccineTypeFifthDose":{"$cond":[{"$eq":["$index.vaccineTypeFifthDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeFifthDose"]}]},"vaccineTypeSixthDose":{"$cond":[{"$eq":["$index.vaccineTypeSixthDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.vaccineTypeSixthDose"]}]},"twoWeeksSinceMostRecentDose":{"$cond":[{"$eq":["$index.twoWeeksSinceMostRecentDose",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.twoWeeksSinceMostRecentDose"]}]},"covidPositiveWithinLast90Days":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveWithinLast90Days"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositivePriorTo90Days":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositivePriorToLast90Days"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveLastWeek":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveLastWeek"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveWeekThreeMonths":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveWeekThreeMonths"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"covidPositiveMoreThanThreeMonths":{"$cond":[{"$eq":["$index.covidPositiveLast90Days",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$indexOfArray":[{"$arrayElemAt":["$TT.screeningAnswers.value","$index.covidPositiveLast90Days"]},"covidPositiveMoreThanThreeMonths"]},{"$numberInt":"-1"}]},null,"Yes"]}]},"testReasonPastOrFutureTravel":{"$cond":[{"$eq":["$index.testReasonPastOrFutureTravel",{"$numberInt":"-1"}]},null,{"$arrayElemAt":["$TT.screeningAnswers.displayValue","$index.testReasonPastOrFutureTravel"]}]},"FluInterest":{"$cond":[{"$eq":["$index.FluInterest",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluInterest"]},"Yes"]},"Yes","No"]}]},"FluTakenAntiViral":{"$cond":[{"$eq":["$index.FluTakenAntiViral",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTakenAntiViral"]},"Yes"]},"Yes","No"]}]},"FluTreatInterest":{"$cond":[{"$eq":["$index.FluTreatInterest",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTreatInterest"]},"Yes"]},"Yes","No"]}]},"FluTreatFlumist":{"$cond":[{"$eq":["$index.FluTreatFlumist",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTreatFlumist"]},"Yes"]},"Yes","No"]}]},"FluTreatPostPartum":{"$cond":[{"$eq":["$index.FluTreatPostPartum",{"$numberInt":"-1"}]},null,{"$cond":[{"$eq":[{"$arrayElemAt":["$TT.surveyAnswers.fluAntiviral.displayValue","$index.FluTreatPostPartum"]},"Yes"]},"Yes","No"]}]}},"patient":{"patientId":"$UP.patientInfo.patientId","firstName":"$UP.patientInfo.firstName","lastName":"$UP.patientInfo.lastName","dob":"$UP.patientInfo.dob","gender":"$UP.patientInfo.gender","race":"$UP.patientInfo.race","ethnicity":"$UP.patientInfo.ethnicity","addressLine1":"$UP.patientInfo.contact.address.line1","addressLine2":"$UP.patientInfo.contact.address.line2","addressCity":"$UP.patientInfo.contact.address.city","addressState":"$UP.patientInfo.contact.address.state","addressZIP":{"$concat":["","$UP.patientInfo.contact.address.zip"]},"phone":{"$let":{"vars":{"phone0":{"$arrayElemAt":["$UP.patientInfo.contact.phones",{"$numberInt":"0"}]}},"in":"$$phone0.number"}}},"voucher":{"group":"$V.groupId","plan":"$V.planId","accessCode":"$VM.accessCode","consentAccept":"$TT.consents.patientInfoVoucher.accepted","consentDate":"$TT.consents.patientInfoVoucher.timestamp"}}},{"$addFields":{"engmt.FluTestQualified":{"$cond":[{"$eq":["$engmt.FluInterest",null]},null,{"$cond":[{"$and":[{"$eq":["$engmt.FluInterest","Yes"]},{"$eq":["$engmt.FluTakenAntiViral","No"]}]},"Yes","No"]}]},"engmt.FluTreatQualified":{"$cond":[{"$eq":["$engmt.FluTreatInterest",null]},null,{"$cond":[{"$and":[{"$eq":["$engmt.FluTreatInterest","Yes"]},{"$eq":["$engmt.FluTreatFlumist","No"]},{"$eq":["$engmt.FluTreatPostPartum","No"]}]},"Yes","No"]}]}}}],"paths":{"testingState":["[3].$match['TS.address.state']"],"testingSite":["[0].$match.storeNumber"],"clinicPartner":["[0].$match.clinicPartner"],"labPartner":["[0].$match.labPartner"],"patientState":["[8].$match['UP.patientInfo.contact.address.state']","[10].$match['UP.patientInfo.contact.address.state']"],"resultsFrom":["[0].$match['result.recordedDate'].$gte"],"resultsTo":["[0].$match['result.recordedDate'].$lt"],"testType":["[0].$match.testId"]}}],"output":{"filename":"ResultsReport.{ISODateTime}.csv","decryption":[{"fieldName":"result.normalizedValue","encryptionTag":{"$numberInt":"1"}},{"fieldName":"result.snomedCode","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.firstName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.lastName","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.dob","encryptionTag":{"$numberInt":"5"}},{"fieldName":"patient.gender","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.race","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.ethnicity","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressLine1","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressLine2","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressCity","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressState","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.addressZIP","encryptionTag":{"$numberInt":"1"}},{"fieldName":"patient.phone","encryptionTag":{"$numberInt":"2"}}],"fields":["result.resultId","result.labPartner","result.clinicPartner","result.orderId","result.normalizedValue","result.manualReason","result.covidAntiviral","result.recordedDate","result.snomedCode","result.createDate","result.updateDate","site.storeNumber","site.cliaNumber","site.street","site.city","site.state","site.zip","site.county","site.status","site.timeZone","engmt.engagementId","engmt.confirmationCode","engmt.specimenSource","engmt.specimenType","engmt.testType","engmt.providerNPI","engmt.providerFirstName","engmt.providerLastName","engmt.currentSymptoms","patient.patientId","patient.firstName","patient.lastName","patient.dob","patient.gender","patient.race","patient.ethnicity","patient.addressLine1","patient.addressLine2","patient.addressCity","patient.addressState","patient.addressZIP","patient.phone","voucher.group","voucher.plan","voucher.accessCode","voucher.consentAccept","voucher.consentDate","engmt.covidVaccinated","engmt.vaccineType","engmt.firstDoseDate","engmt.secondDoseDate","engmt.thirdDoseDate","engmt.fourthDoseDate","engmt.fifthDoseDate","engmt.sixthDoseDate","engmt.engagementType","engmt.recentContactCOVID","engmt.testReasonPastOrFutureTravel","engmt.recentContactUnspecified","engmt.recentExposures","engmt.workSetting","engmt.riskConditions","engmt.isPregnant","engmt.isMedicallyNecessary","engmt.isCashPay","engmt.howManyVaccinesReceived","engmt.vaccineTypeFirstDose","engmt.vaccineTypeSecondDose","engmt.vaccineTypeThirdDose","engmt.vaccineTypeFourthDose","engmt.vaccineTypeFifthDose","engmt.vaccineTypeSixthDose","engmt.twoWeeksSinceMostRecentDose","engmt.covidPastPositive","engmt.covidPositiveWithinLast90Days","engmt.covidPositivePriorTo90Days","engmt.covidPositiveLastWeek","engmt.covidPositiveWeekThreeMonths","engmt.covidPositiveMoreThanThreeMonths","engmt.FluTestQualified","engmt.FluTreatQualified","engmt.FluInterest","engmt.FluTakenAntiViral","engmt.FluTreatInterest","engmt.FluTreatFlumist","engmt.FluTreatPostPartum"],"batchSize":{"$numberInt":"5000"}}}
